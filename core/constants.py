"""
Константы приложения.

Все магические числа собраны в одном месте.
Легко найти, понять и изменить.
"""
import numpy as np
# ============================================================
# ГЕОМЕТРИЯ ТРЕУГОЛЬНИКА
# ============================================================

# Высота равностороннего треугольника со стороной 1
TRIANGLE_HEIGHT = np.sqrt(3) / 2

# Отступы для отображения (чтобы метки не обрезались)
PLOT_MARGIN = 0.15

# Отступ подписей вершин от точки
VERTEX_LABEL_OFFSET = 0.05

# Отступ подписей составов от точки
COMP_LABEL_OFFSET = 0.03


# ============================================================
# ЧИСЛЕННЫЕ ДОПУСКИ (EPSILON)
# ============================================================

# Проверка на ноль (деление, длина вектора)
# Используется: len_sq < EPSILON_ZERO
EPSILON_ZERO = 1e-12

# Проверка точки на границе (чуть жестче для научной точности)
EPSILON_BOUNDARY = 1e-10

# Сравнение двух точек на математическое совпадение (Identity)
# Должно быть сопоставимо с точностью стехиометрии (5e-5)
EPSILON_COINCIDENT = 5e-5

# Абсолютный допуск сравнения составов (в мольных долях)
# 5e-5 = 0.005 мол.% — соответствует RATIO_TOLERANCE для стехиометрии
COMPOSITION_COMPARISON_ATOL = 5e-5

# Допуск для параметра интерполяции t ∈ [0, 1]
# Точка на отрезке, если -EPSILON_SEGMENT <= t <= 1 + EPSILON_SEGMENT
# Используется в анализе рычага и проверке "внутри треугольника"
EPSILON_SEGMENT = 1e-3

# Допуск для проверки коллинеарности (точка на прямой)
# Используется в научных расчётах (Analysis Panel)
# 1e-4 = 0.01 мол.% — высокая научная точность
TOLERANCE_ON_LINE_STRICT = 1e-4

# Допуск для UI-интерактивности (hover, click detection)
# 1% — достаточно для визуального определения
TOLERANCE_ON_LINE_UI = 0.01

# Точность для поиска целочисленных соотношений (0.005 моль.%)
RATIO_TOLERANCE = 5e-5


# ============================================================
# ЛИМИТЫ ЗНАЧЕНИЙ
# ============================================================

# Сетка
GRID_STEP_MIN = 0.01
GRID_STEP_MAX = 0.5
GRID_STEP_DEFAULT = 0.1

# Размер маркера
MARKER_SIZE_MIN = 0.5
MARKER_SIZE_MAX = 50.0
MARKER_SIZE_DEFAULT = 4.0

# Толщина линии
LINE_WIDTH_MIN = 0.5
LINE_WIDTH_MAX = 10.0
LINE_WIDTH_DEFAULT = 2.0

# Максимальный знаменатель поиска дроби.
# Ставим 1,000,000, чтобы алгоритм мог найти соотношения с точностью 10^-5-10^-6.
# Это позволяет находить как [1, 2], так и [1, 999999].
RATIO_MAX_DENOMINATOR = 1000000

# Максимальная длина имени состава
COMP_NAME_MAX_LENGTH = 100

# Максимальное значение координаты в UI (clamping)
COORD_INPUT_MIN = 0.0
COORD_INPUT_MAX = 1000.0

# ============================================================
# СИСТЕМНЫЕ КОНСТАНТЫ
# ============================================================

# Ограничения ввода
COORD_INPUT_MIN = 0.0
COORD_INPUT_MAX = 1.0

# Точность отображения
DISPLAY_DECIMALS_TABLE = 4
DISPLAY_DECIMALS_CURSOR = 4
DISPLAY_DECIMALS_ANALYSIS = 3

# ============================================================
# ТЕКСТЫ И ПОДСКАЗКИ
# ============================================================

# Единицы измерения
UNITS_MOLAR_FRACTION = "mol. fraction"
UNITS_MOLAR_PERCENT = "mol.%"

# Tooltips для координат
TOOLTIP_COORDINATE = "Molar fraction (0 to 1). Values are automatically normalized so that A + B + C = 1"
TOOLTIP_COORDINATE_SHORT = "Molar fraction (normalized)"

# Порог для предупреждения о ненормализованных данных
# Если |sum - 1.0| > этого значения, показываем предупреждение
NORMALIZATION_WARNING_THRESHOLD = 0.01  # 1%

# ============================================================
# ЦВЕТА ПО УМОЛЧАНИЮ
# ============================================================

COLOR_DEFAULT_COMP = "#000000"
COLOR_DEFAULT_LINE = "#000000"
COLOR_BACKGROUND = "#FFFFFF"

# Overlay
COLOR_PROJECTION = "blue"
COLOR_INTERSECTION = "red"
COLOR_EXTRAPOLATION = "gray"
COLOR_TERNARY_TRIANGLE = "green"


# ============================================================
# Z-ORDER (порядок отрисовки)
# ============================================================

ZORDER_GRID = 1
ZORDER_LINES = 2
ZORDER_COMPS = 5
ZORDER_OVERLAY = 10
ZORDER_INTERSECTION = 100
ZORDER_PROJECTION = 101
